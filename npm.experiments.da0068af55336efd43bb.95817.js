(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["npm.experiments"],{"237c":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LocalStorageStore=void 0;const i=n("9677"),o=n("b763"),r=n("d9ab");class s extends i.ChainableStore{constructor(t){super(t)}getOrCreate(t,e){let n=null;return this.isStorageAvailable()&&(n=localStorage.getItem(t)?localStorage.getItem(t):null!=this._nextStore?this._nextStore.getOrCreate(t,e):null),null===n?e():n}saveOrUpdateValue(t,e){return this.isStorageAvailable()&&localStorage.setItem(t,e),e}isStorageAvailable(){return(0,r.safeIsClient)()&&(0,o.storageAvailable)("localStorage")}}e.LocalStorageStore=s},2999:function(t,e,n){"use strict";function i(t,e){const n=Object.assign(Object.assign({},e),t);return"undefined"===typeof n.retries&&(n.retries=e.retries),"undefined"===typeof n.retryDelay&&(n.retryDelay=e.retryDelay),"undefined"===typeof n.retryOn&&(n.retryOn=e.retryOn),n}function o(t,e={}){const n=i(e,{retries:3,retryDelay:500,retryOn:[419,503,504]});return function(e,o){const r=i({retries:null===o||void 0===o?void 0:o.retries,retryDelay:null===o||void 0===o?void 0:o.retryDelay,retryOn:null===o||void 0===o?void 0:o.retryOn},n),s="function"===typeof r.retryDelay?r.retryDelay:()=>r.retryDelay,a="function"===typeof r.retryOn?r.retryOn:(t,e,n,i,o)=>(!!i||!o||-1!==r.retryOn.indexOf(o.status))&&e<n;return new Promise((function(n,i){const u=function(s){t(e,o).then((function(t){a(e,s,r.retries,null,t)?c(s,null,t):n(t)})).catch((function(t){a(e,s,r.retries,t,null)?c(s,t,null):i(t)}))};function c(t,e,n){setTimeout((function(){u(++t)}),s(t,e,n))}u(0)}))}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o},"2e4f":function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var o=Object.getOwnPropertyDescriptor(e,n);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,o)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return o(e,t),e},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.AllowedNamespace=e.camelizeObjKeys=e.tracer=e.default=void 0;const a=n("b310"),u=n("d1b8"),c=s(n("46c9f")),l=r(n("fe9c")),d=s(n("51d1")),h=s(n("a457c")),v=s(n("6fd4")),f=n("8ec4");Object.defineProperty(e,"camelizeObjKeys",{enumerable:!0,get:function(){return f.camelizeObjKeys}});const p=n("79de");Object.defineProperty(e,"AllowedNamespace",{enumerable:!0,get:function(){return p.AllowedNamespace}});const g=s(n("73c8")),m=n("d9ab"),_=(new u.ExperimentationConfigBuilder).setErrorHandler({handleError:(t,e)=>{console.error(t)}}).build(),b=(0,a.v4)(),E=new d.default({valueGenerator:()=>b,allowSubdomain:!0});E.getOrCreate().catch(t=>console.log(t));const y=new h.default(E),O=new v.default(y,l.traceConfigByEnvironment.prod);if((0,m.safeIsClient)()){const t=new g.default({allowSubdomain:!0},18e5,O);y.setSession(t)}const T=c.default.getInstance(O,y);e.default=T,T.fetch(_).catch(t=>console.error(t)),S("ExperimentationConfig",u.ExperimentationConfig),S("ExperimentationConfigBuilder",u.ExperimentationConfigBuilder);const C=new l.default(l.traceConfigByEnvironment.prod,E,y,O);function S(t,e){Object.defineProperty(T,t,{value:e,writable:!0,enumerable:!0,configurable:!0})}e.tracer=C,C.initCodaCookieId().catch(t=>console.error(t)),C.initMetadata().catch(t=>console.error(t))},"2fa2":function(t,e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});const o=n("809e"),r=n("237c"),s=n("3b9a");class a{constructor(t){this.cfg=t,this._store=new o.CookieStore(new r.LocalStorageStore,t)}getOrCreate(t,e){const n=this.getValidUserContextKey(t);if(!n)return e();const i=this.getJsonValueFromStore(),o=i[n[a.USER_CONTEXT_KEY]];return o?(a.cache[n[a.USER_CONTEXT_KEY]]=o,o):this.set(n[1],e())}set(t,e){const n=this.getValidUserContextKey(t);if(!n)return e;if("string"!==typeof e&&"number"!==typeof e)return e;const i=this.getJsonValueFromStore();i[n[a.USER_CONTEXT_KEY]]=e;const o=JSON.stringify(i);return a.cache[n[a.USER_CONTEXT_KEY]]=e,this._store.syncValue(a.TREX_USER_CONTEXT_KEY,o),e}getJsonValueFromStore(){const t=this._store.getOrCreate(a.TREX_USER_CONTEXT_KEY,()=>"");let e={};if(""===t)return e;let n=t;"string"!==typeof t&&(n=(0,s.safeToString)(t));try{e=JSON.parse(n)}catch(i){console.error(i)}return this._store.syncValue(a.TREX_USER_CONTEXT_KEY,n),e}getCachedValue(t){return a.cache[t]}clearCachedValue(){a.cache={}}getValidUserContextKey(t){return a.VALID_USER_CONTEXT_KEY.find(e=>t===e[a.INPUT_KEY])}}e.default=a,i=a,a.TREX_USER_CONTEXT_KEY="trex-user-context",a.INPUT_KEY=0,a.USER_CONTEXT_KEY=1,a.CODA_COOKIE_ID_FE_KEY="coda-cookie-id",a.VALID_USER_CONTEXT_KEY=[[i.CODA_COOKIE_ID_FE_KEY,i.CODA_COOKIE_ID_FE_KEY],["codaCookieId",i.CODA_COOKIE_ID_FE_KEY],["exptToken","exptToken"]],a.cache={}},3906:function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var o=Object.getOwnPropertyDescriptor(e,n);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,o)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return o(e,t),e},s=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=a(n("2999"));class c{constructor(t){var e,i,o,a;this.withKeepAlive=!1,this.histories=[];const l={timeoutMs:(null!==(e=null===t||void 0===t?void 0:t.timeoutMs)&&void 0!==e?e:0)>0?t.timeoutMs:c.DEFAULT_CONFIG.timeoutMs,retries:null!==(i=null===t||void 0===t?void 0:t.retries)&&void 0!==i?i:c.DEFAULT_CONFIG.retries,retryDelay:null!==(o=null===t||void 0===t?void 0:t.retryDelay)&&void 0!==o?o:c.DEFAULT_CONFIG.retryDelay,retryOn:null!==(a=null===t||void 0===t?void 0:t.retryOn)&&void 0!==a?a:c.DEFAULT_CONFIG.retryOn},d=(t,e)=>s(this,void 0,void 0,(function*(){var i;const o=new AbortController,s={effectiveCfg:l};this.histories.push(s);try{s.timeoutId=globalThis.setTimeout(()=>o.abort(),s.effectiveCfg.timeoutMs);const a=null!==(i=globalThis.fetch)&&void 0!==i?i:(yield Promise.resolve().then(()=>r(n("a18f")))).default;return yield a(t,Object.assign(Object.assign({},e),{signal:o.signal}))}finally{clearTimeout(s.timeoutId),s.clearedTimeoutId=s.timeoutId}}));this.fetcher=(0,u.default)(d,l)}fetch(t,e){return s(this,void 0,void 0,(function*(){if(this.withKeepAlive&&e){const t="string"===typeof e.body?e.body.length:0;e=Object.assign(Object.assign({},e),{keepalive:t<=65536})}return this.fetcher(t,e)}))}setKeepAlive(t){this.withKeepAlive=t}getHistories(){return[...this.histories]}}e.default=c,c.LOG_PREFIX="trex256",c.DEFAULT_CONFIG={timeoutMs:8e3,retries:2,retryDelay:300,retryOn:(t,e,n,i,o)=>e<n&&(null!==i||null==o||o.status>=400)}},"3b9a":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getOrDefaultFromMap=e.getOrDefault=e.kebabToCamel=e.safeToString=e.isFunction=e.cleanedAttributes=e.isValidAttribute=void 0;const i=new Set(["string","number","boolean"]);function o(t){if(void 0===t)return!1;if(null==t)return!0;const e=typeof t;return i.has(e)}function r(t){const e=Object.keys(t),n={};return e.forEach(e=>{s(t[e])||(n[e]=t[e])}),n}function s(t){return null!==t&&"function"===typeof t}function a(t){let e;try{e=JSON.stringify(t)}catch(n){e=String(t)}return e}function u(t){return t.replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function c(t,e,n){return t&&e&&void 0!==t[e]?t[e]:n}function l(t,e,n){return t&&e&&void 0!==t.get(e)?t.get(e):n}e.isValidAttribute=o,e.cleanedAttributes=r,e.isFunction=s,e.safeToString=a,e.kebabToCamel=u,e.getOrDefault=c,e.getOrDefaultFromMap=l},"3efd":function(t,e,n){"use strict";function i(){var t;if(null==globalThis.history)return;const e=globalThis.history,n=null!=e.onpushstateCallbacks;if(!n){const n=function(t){var n;for(const[o,r]of(null!==(n=e.onpushstateCallbacks)&&void 0!==n?n:[]).entries())try{r({state:t})}catch(i){console.error(`Error processing callback with id ${o}:`,i)}},i=e.pushState;e.onpushstateCallbacks=new Map,e.pushState=function(t,o,r){return n(t),i.apply(e,[t,o,r])},e.setOnPushStateCallback=function(t,n){var i;return null===(i=e.onpushstateCallbacks)||void 0===i||i.set(t,n),e},e.unsetOnPushStateCallback=function(t){var n,i;return null!==(i=null===(n=e.onpushstateCallbacks)||void 0===n?void 0:n.delete(t))&&void 0!==i&&i},null===(t=globalThis.window)||void 0===t||t.addEventListener("popstate",t=>{var e;n(null!==(e=t.state)&&void 0!==e?e:{})})}return globalThis.history}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},"46c9f":function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var o=Object.getOwnPropertyDescriptor(e,n);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,o)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return o(e,t),e},s=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=n("c5b0"),c=n("d1b8"),l=n("a534"),d=a(n("2999")),h=n("b763"),v=a(n("651e")),f=n("b310"),p=n("dbcf"),g=n("d9ab"),m=n("3b9a"),_=a(n("2fa2")),b=a(n("3906"));class E extends l.ExperimentationBase{constructor(){super(),this._featuresJson={},this._gbIsReady=!1,this._canRefresh=!0,this.DATA_AUTO_TRACK_KEY="data-auto-capture",this.TRACK_CUSTOM_KEY="capture-custom-",this._arrResolveGB=new Map,this._trexUserContextStore=new _.default({allowSubdomain:!0}),this._gb=new u.GrowthBook({enableDevMode:!0,trackingCallback:(t,e)=>{this._trackingCallbackImpl(t,e)}})}static getInstance(t,e){return"undefined"!==typeof E.instance&&null!==E.instance||(E.instance=new E,E.instance._customEventTracer=t,E.instance._metadata=e),E.instance}init(t){(0,p.safeGuard)(()=>{var e,n,i,o;this.updateEnv(t.environment),null===(e=this._metadata)||void 0===e||e.setNamespace(t.namespace),null===(n=this._customEventTracer)||void 0===n||n.setKeepAlive(null!==(i=t.keepalive)&&void 0!==i&&i),this._enableAutoRefresh(null!==(o=t.autoRefreshInterval)&&void 0!==o?o:0)})}_enableAutoRefresh(t=0){t<=0||this._refreshTimer||(this._refreshTimer=setInterval(()=>{this._canRefresh&&(this._canRefresh=!1,this.refresh().finally(()=>{this._canRefresh=!0}))},t))}isReady(t=5e3){var e;return s(this,void 0,void 0,(function*(){if(this._gbIsReady)return!0;const n=Symbol("key"),i=null===(e=this.getCfg())||void 0===e?void 0:e.version;return new Promise(e=>{const o=setTimeout(()=>{e(!1),this._arrResolveGB.delete(n)},t);this._arrResolveGB.set(n,t=>{t===i&&(clearTimeout(o),e(!0),this._arrResolveGB.delete(n))})})}))}updateEnv(t){var e,n,i;const o=t;if(!o)return;let r=!0;if(this.isValidEnv(o)||(console.log(`Invalid input, current env ${null===(e=this.getCfg())||void 0===e?void 0:e.mode}, current input ${o}`),r=!1),o===(null===(n=this.getCfg())||void 0===n?void 0:n.mode)&&(r=!1),r){const t=(new c.ExperimentationConfigBuilder).setErrorHandler({handleError:(t,e)=>{console.error(t)}}).setMode(o).build();this.fetch(t).catch(t=>console.log(t)),null===(i=this._customEventTracer)||void 0===i||i.setEnv(o)}}isValidEnv(t){return"prod"===t||"qa"===t||"dev"===t}_trackingCallbackImpl(t,e){var n;return s(this,void 0,void 0,(function*(){const i={deviceId:this._cachedDeviceId,anonymousId:this._getOrCreateAnonymousId(),experimentId:t.key,variationId:e.variationId,resultValue:e.value};Object.assign(i,this._gb.getAttributes()),null===(n=this._customEventTracer)||void 0===n||n.traceExperimentViewedEvent(i)}))}_getOrCreateAnonymousId(){try{return(0,h.getOrCreateSegmentAnonymousId)(this._getOrGenerateSegmentAnonymousId)}catch(t){console.error(t);let e="Unknown Error";t instanceof Error&&(e=t.message);const n="getOrCreateAnonymousId error "+e;return console.error("returning error result:",n),n}}_getOrGenerateSegmentAnonymousId(){const t="ajs_anonymous_id",e=(0,v.default)();let n=e.get(t);return n||(n=(0,f.v4)(),e.set(t,n)),n}_trackExperimentToKafkaRestProxy(t,e){var i;return s(this,void 0,void 0,(function*(){const o=null!==(i=null===globalThis||void 0===globalThis?void 0:globalThis.fetch)&&void 0!==i?i:(yield Promise.resolve().then(()=>r(n("a18f")))).default,s=(0,d.default)(o,{retries:5,retryDelay:500,retryOn:[408,425,429,500,502,503,504]}),a='{"records":[{"value": '+JSON.stringify(t)+"}]}";return yield s(e.eventTrackingUrl,{method:"POST",headers:{Accept:"*/*","Content-Type":"application/vnd.kafka.json.v2+json"},body:a})}))}fetch(t){return s(this,void 0,void 0,(function*(){this._gbIsReady=!1,this._configurationUpdated(t),this._gb=new u.GrowthBook({enableDevMode:!t.isProductionMode,trackingCallback:(t,e)=>{this._trackingCallbackImpl(t,e)},features:this._featuresJson});const e={timeoutMs:t.fetchTimeoutMs||c.ExperimentationConfig.DEFAULT_FETCH_TIMEOUT_MS,retries:t.fetchMaxRetries||c.ExperimentationConfig.DEFAULT_FETCH_MAX_RETRIES};return new b.default(e).fetch(t.endPointUrl).then(t=>{if(t.ok)return t.json();throw new Error(`fetching features not ok, with status ${t.status} / ${t.statusText}, with resp headers of ${JSON.stringify(t.headers)}`)}).then(e=>{var n;return t.version===(null===(n=this.getCfg())||void 0===n?void 0:n.version)&&(this._featuresJson=e.features,this._gb.setFeatures(e.features),this._featuresFetched()),this._notifyIsReady(t.version),this})}))}_notifyIsReady(t){var e;if(t===(null===(e=this.getCfg())||void 0===e?void 0:e.version)&&(this._gbIsReady=!0,this._arrResolveGB))for(const n of this._arrResolveGB.values())n(t)}_populateAttributes(){var t,e,n;const i=(null===(t=this._metadata)||void 0===t?void 0:t.getCustomAttributes().get())||{};return i.codaCookieId=null===(n=null===(e=this._metadata)||void 0===e?void 0:e.codaCookieId)||void 0===n?void 0:n.getValue(),i.exptTokenId=this.getExptTokenId(),this._gb.setAttributes(i),i}isOn(t,e){let n=this._populateAttributes();return e&&(n=this.overrideGB(e)),this._isOn(t,n)}overrideGB(t){var e,n,i;const o=this._populateAttributes(),r=Object.assign(Object.assign({},null!==(e=o.customMetadata)&&void 0!==e?e:{}),t);r.codaCookieId=null!==(n=r["coda-cookie-id"])&&void 0!==n?n:r.codaCookieId,delete r["coda-cookie-id"];const s=Object.assign(Object.assign(Object.assign({},o),r),{customMetadata:r});return this._gb=new u.GrowthBook({enableDevMode:!(null===(i=this.getCfg())||void 0===i?void 0:i.isProductionMode),trackingCallback:(t,e)=>{(()=>{var n;const i={experimentId:t.key,variationId:e.variationId,resultValue:e.value};Object.assign(i,s),null===(n=this._customEventTracer)||void 0===n||n.traceExperimentViewedEvent(i)})()},features:this._featuresJson,attributes:s}),s}_isOn(t,e){return this._whiteLabelAwareExec(t,e,()=>this._gb.isOn(t),!1)}isOff(t){const e=this._populateAttributes();return this._isOff(t,e)}_isOff(t,e){return this._whiteLabelAwareExec(t,e,()=>this._gb.isOff(t),!0)}getFeatureValue(t,e,n){let i=this._populateAttributes();return n&&(i=this.overrideGB(n)),this._whiteLabelAwareExec(t,i,()=>this._gb.getFeatureValue(t,e),e)}getSerializedContext(){return s(this,void 0,void 0,(function*(){const t=yield this.callSerializedContext();return t.ok?t.value:"{}"}))}deserializeOrCreateContext(t){return s(this,void 0,void 0,(function*(){try{return JSON.parse(t)}catch(e){return{"coda-cookie-id":(0,f.v4)()}}}))}enableAutoTrack(){(0,g.safeIsClient)()&&document.body.addEventListener("click",this.handleAutoTrackClick.bind(this))}parseDeserializedContext(t){return s(this,void 0,void 0,(function*(){let e={};try{e=JSON.parse(t)}catch(n){return void console.error(n)}for(const t in e){const n=e[t];this._trexUserContextStore.set(t,n)}}))}handleAutoTrackClick(t){(0,p.safeGuard)(()=>{var e;const n=[];let i=t.target;while(i){const t=i;i=t.parentElement,this.collectEventData(t,n)}n.length>0&&(null===(e=this._customEventTracer)||void 0===e||e.traceClickEvent(n))})}collectEventData(t,e){const n=null===t||void 0===t?void 0:t.attributes;if(!n)return;const i=n.getNamedItem(this.DATA_AUTO_TRACK_KEY);if(!i)return;const o=i.value;if(0===o.trim().length)return;const r=Array.from(n).filter(t=>t.name.startsWith(this.TRACK_CUSTOM_KEY)&&t.name!==this.TRACK_CUSTOM_KEY).reduce((t,e)=>{const n=e.name.replace(this.TRACK_CUSTOM_KEY,"");return t[(0,m.kebabToCamel)(n)]=e.value,t},{}),s={eventName:o,elementId:t.id,elementClass:t.classList.value,eventData:r};e.push(s)}callSerializedContext(){return s(this,void 0,void 0,(function*(){return(0,p.safeGuard)(()=>s(this,void 0,void 0,(function*(){var t;const e=yield null===(t=this._metadata)||void 0===t?void 0:t.getOrPopulate(),n=Object.assign(Object.assign({},e),{exptToken:yield this.getExptToken()});return Object.assign(n,(null===e||void 0===e?void 0:e.customMetadata)||{}),delete n.customMetadata,delete n.utmTerm,JSON.stringify(n)})))}))}_whiteLabelAwareExec(t,e,n,i){try{return"whiteLabelId"in e&&null!==e.whiteLabelId&&void 0!==e.whiteLabelId&&this._featuresJson[t]&&!this._hasWhiteLabelIdInCondition(this._featuresJson[t])?i:n()}catch(o){return console.error(o),i}}_hasWhiteLabelIdInCondition(t){var e;const n=null!==(e=null===t||void 0===t?void 0:t.rules)&&void 0!==e?e:null;return!!n&&Array.isArray(n)&&n.some(t=>t.condition&&"whiteLabelId"in t.condition)}}e.default=E,E.NON_FEATURE_KEYS=["dateUpdated"]},"51d1":function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n("2fa2"));class s{constructor(t){var e;this._cfg=t,this._trexCookieStore=new r.default({allowSubdomain:null===(e=null===t||void 0===t?void 0:t.allowSubdomain)||void 0===e||e})}getOrCreate(){return i(this,void 0,void 0,(function*(){return this._trexCookieStore.getOrCreate(this.getKey(),()=>this._cfg.valueGenerator())}))}getKey(){return s.KEY}getValue(){return this._trexCookieStore.getCachedValue(this.getKey())}}e.default=s,s.KEY="coda-cookie-id"},"6a28":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i="0.42.4";e.default=i},"6fd4":function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n("3906")),s=o(n("fe0e")),a=n("dbcf"),u=n("3b9a"),c=n("fe9c");function l(t={}){var e,n;return{eventData:null!==(e=t.eventData)&&void 0!==e?e:{},customMetaData:null!==(n=t.customMetaData)&&void 0!==n?n:{}}}function d(t={}){var e;return{payloadArr:null!==(e=t.payloadArr)&&void 0!==e?e:[]}}function h(t={}){var e;return Object.assign({eventName:null!==(e=t.eventName)&&void 0!==e?e:""},d(t))}function v(t={}){return Object.assign({},d(t))}function f(t={}){var e;return{payloads:null!==(e=t.payloads)&&void 0!==e?e:[]}}const p="dev";class g{constructor(t,e){this.metadata=t,this.cfg=e,this.fetcher=new r.default({timeoutMs:2e3,retries:3}),this.env="prod"}setEnv(t){this.env=t,this.cfg=c.traceConfigByEnvironment[t]}getMetadata(){return this.metadata}setKeepAlive(t){this.fetcher.setKeepAlive(t)}tracePageViewEvent(t){return i(this,void 0,void 0,(function*(){return(0,a.safeGuard)(()=>i(this,void 0,void 0,(function*(){var e,n,i,o,r,s,a,u,c,l,d,h;const v=yield this.metadata.getOrPopulate(),f=Object.assign(Object.assign({},v),{title:document.title,path:null===(n=null===(e=globalThis.document)||void 0===e?void 0:e.location)||void 0===n?void 0:n.pathname,referrerUrl:null===(i=globalThis.document)||void 0===i?void 0:i.referrer,locale:(null!==(a=null===(s=null===(r=null===(o=globalThis.document)||void 0===o?void 0:o.location)||void 0===r?void 0:r.pathname)||void 0===s?void 0:s.match(g.REGEX_LOCALE))&&void 0!==a?a:[])[1],additionalInfo:(null===(l=null===(c=null===(u=null===globalThis||void 0===globalThis?void 0:globalThis.document)||void 0===u?void 0:u.location)||void 0===c?void 0:c.search)||void 0===l?void 0:l.includes("debug=true"))?Object.assign(Object.assign({},(null===t||void 0===t?void 0:t())||{}),{url:null===(h=null===(d=null===globalThis||void 0===globalThis?void 0:globalThis.document)||void 0===d?void 0:d.location)||void 0===h?void 0:h.href}):null===t||void 0===t?void 0:t()});return this.env===p?this.logTracing(f):this.postCustomEvent(this.cfg.pageViewEndpoint,()=>f)})))}))}traceClickEvent(t){return i(this,void 0,void 0,(function*(){return(0,a.safeGuard)(()=>i(this,void 0,void 0,(function*(){const e=yield this.metadata.getOrPopulate(),n=t.map(t=>Object.assign(Object.assign({},t),e));return this.env===p?this.logTracing(n):this.postCustomEvent(this.cfg.clickEventEndpoint,()=>n)})))}))}traceExperimentViewedEvent(t,e={}){return i(this,void 0,void 0,(function*(){return this.env===p?(0,a.safeGuard)(()=>this.logTracing({payloadArr:[{eventData:t,customMetaData:e}]})):this.traceExperimentViewedEvents({payloadArr:[{eventData:t,customMetaData:e}]})}))}traceExperimentViewedEvents(t){return i(this,void 0,void 0,(function*(){return(0,a.safeGuard)(()=>i(this,void 0,void 0,(function*(){t=d(t);const e=yield this.metadata.getOrPopulate(),n=[];for(let i=0;i<t.payloadArr.length;i++){const o=l(t.payloadArr[i]),r=(0,u.cleanedAttributes)(o.eventData);n.push(Object.assign(Object.assign(Object.assign({},e),o.customMetaData),r))}return this.env===p?this.logTracing(n):this.postCustomEvent(this.cfg.experimentViewedEndpoint,()=>n)})))}))}traceCustomEvent(t,e,n={}){return i(this,void 0,void 0,(function*(){return this.env===p?(0,a.safeGuard)(()=>this.logTracing({eventName:t,payloadArr:[{eventData:e,customMetaData:n}]})):this.traceCustomEvents({eventName:t,payloadArr:[{eventData:e,customMetaData:n}]})}))}traceCustomEvents(t){return i(this,void 0,void 0,(function*(){return(0,a.safeGuard)(()=>i(this,void 0,void 0,(function*(){t=h(t);const e=yield this.metadata.getOrPopulate(),n=[];for(let i=0;i<t.payloadArr.length;i++){const o=l(t.payloadArr[i]),r=(0,u.cleanedAttributes)(o.eventData),s=""!==t.eventName.trim();s?n.push(Object.assign(Object.assign(Object.assign({},e),o.customMetaData),{eventName:t.eventName,eventData:r})):console.error(`uneligible payload for custom event posting: ${(0,u.safeToString)(o)}, with endpoint of ${this.cfg.customEventEndpoint}`)}return this.env===p?this.logTracing(n):this.postCustomEvent(this.cfg.customEventEndpoint,()=>n)})))}))}traceIdentifyEvent(t,e={}){return i(this,void 0,void 0,(function*(){return this.env===p?(0,a.safeGuard)(()=>this.logTracing({payloadArr:[{eventData:t,customMetaData:e}]})):this.traceIdentifyEvents({payloadArr:[{eventData:t,customMetaData:e}]})}))}traceIdentifyEvents(t){return i(this,void 0,void 0,(function*(){return(0,a.safeGuard)(()=>i(this,void 0,void 0,(function*(){t=v(t);const e=yield this.metadata.getOrPopulate(),n=[];for(let i=0;i<t.payloadArr.length;i++){const o=l(t.payloadArr[i]),r=(0,u.cleanedAttributes)(o.eventData),s=null!==e.codaCookieId;if(s){const t=Object.assign({},r);n.push(Object.assign(Object.assign(Object.assign({},e),o.customMetaData),{eventData:t}))}else console.error(`uneligible payload for identify event posting: ${(0,u.safeToString)(o)}, with endpoint of ${this.cfg.identifyEventEndpoint}`)}return this.env===p?this.logTracing(n):this.postCustomEvent(this.cfg.identifyEventEndpoint,()=>n)})))}))}traceSessionEvent(t,e={},n){return i(this,void 0,void 0,(function*(){return this.env===p?(0,a.safeGuard)(()=>this.logTracing({payloadArr:[{eventName:t,customMetadata:e}]})):this.traceSessionEvents({payloads:[{eventName:t,customMetadata:e}]},n)}))}traceSessionEvents(t,e){return i(this,void 0,void 0,(function*(){return(0,a.safeGuard)(()=>i(this,void 0,void 0,(function*(){var n;t=f(t);const i=[];for(let o=0;o<(null!==(n=t.payloads)&&void 0!==n?n:[]).length;o++){const n=null!==e.codaCookieId,r=Object.assign(Object.assign(Object.assign({},e),t.payloads[o].customMetadata),{eventName:t.payloads[o].eventName});n?i.push(r):console.error(`uneligible payload for session event posting: ${(0,u.safeToString)(r)}, with endpoint of ${this.cfg.sessionEndpoint}`)}return this.env===p?this.logTracing(i):this.postCustomEvent(this.cfg.sessionEndpoint,()=>i)})))}))}postCustomEvent(t,e){return i(this,void 0,void 0,(function*(){const n=e(),i=Array.isArray(n)?n:[n],o=i.length>0;if(!o){const e="uneligible empty array for custom event posting with endpoint of "+t;throw console.error(e),new Error(e)}return(0,s.default)(t,this.fetcher,...i)}))}logTracing(t){const e={payload:[],finalPayload:{records:[]},response:new Response};return console.log("Currently in dev env, logging instead of sending to kafka"),console.log("Payload: "+JSON.stringify(t)),Promise.resolve(e)}}e.default=g,g.EXPERIMENT_VIEWED_EVENT_NAME="ExperimentViewed",g.REGEX_LOCALE=/^\/([a-z]{2}-[a-z]{2})\/?/},"73c8":function(t,e,n){"use strict";var i=this&&this.__rest||function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n};Object.defineProperty(e,"__esModule",{value:!0});const o=n("c5a8"),r=n("809e");class s{constructor(t,e,n){var i;this._cfg=t,this.timeoutMs=e,this._store=new r.CookieStore(void 0,{allowSubdomain:null===(i=null===t||void 0===t?void 0:t.allowSubdomain)||void 0===i||i}),this._timeoutMs=e,this._customEventTracer=n}get(t,e){const n=Date.now(),i=this._store.getOrCreate(s.SESSION_ID_KEY,()=>n),o=this._store.getOrCreate(s.LAST_ACTION_KEY,()=>n),r=this._store.getOrCreate(s.SESSION_NUM_KEY,()=>0),a=[];let u=!1;return(null===t||void 0===t?void 0:t.newCampaign)&&(u=this.handleNewCampaign(a,i,r,o,n,t.oldCampaignObj,t.newCampaignObj)),!u&&this.isSessionTimedOut(n,o)&&(u=this.handleSessionTimeout(a,t,i,r,o,n,t.oldCampaignObj,t.newCampaignObj)),!u&&this.isSessionJustInitiated(i,r,n)&&(u=this.handleNewSessionInitiation(a,i,r,n,t.newCampaignObj)),this.updatelastActionTime(n),u?this._customEventTracer.traceSessionEvents({payloads:this.transformPayload(a)},e):a.push(this.generateSessionRunning(i,r,n,t.oldCampaignObj)),a[a.length-1]}setCustomEventTracer(t){this._customEventTracer=t}handleNewCampaign(t,e,n,i,o,r,s){return e!==o&&t.push(this.generateSessionClose(e,n,i,r)),t.push(this.generateSessionStart(o,n,o,s)),this.updateSessionData(o),!0}isSessionTimedOut(t,e){return t-e>=this._timeoutMs}handleSessionTimeout(t,e,n,i,o,r,s,a){return e&&!e.campaignOverride&&this.deleteCampaignData(),t.push(this.generateSessionClose(n,i,o,s)),t.push(this.generateSessionStart(r,i,r,a)),this.updateSessionData(r),!0}isSessionJustInitiated(t,e,n){return t===n&&0===e}handleNewSessionInitiation(t,e,n,i,o){return t.push(this.generateSessionStart(e,n,i,o)),this.updateSessionData(i),!0}updateSessionData(t){this._store.saveOrUpdateValue(s.SESSION_ID_KEY,t),this._store.saveOrUpdateValue(s.LAST_ACTION_KEY,t),this.incrementSessionNum()}updatelastActionTime(t){this._store.saveOrUpdateValue(s.LAST_ACTION_KEY,t)}deleteCampaignData(){const t=["campaignId","utmCampaign","utmSource","utmMedium","utmContent","utmTerm","cid"];t.forEach(t=>{(0,o.removeItem)(t)})}transformPayload(t){const e=t.map(t=>{const{lastActionTime:e,eventName:n}=t,o=i(t,["lastActionTime","eventName"]);return{customMetadata:Object.assign({},o),eventName:t.eventName}});return e}generateSessionStart(t,e,n,i){return this.insertSessionData(s.SESSION_START,t,e+1,n,i)}generateSessionClose(t,e,n,i){return this.insertSessionData(s.SESSION_CLOSE,t,e,n,i)}generateSessionRunning(t,e,n,i){return this.insertSessionData("",t,e,n,i)}insertSessionData(t,e,n,i,o){return Object.assign({eventName:t,sessionId:e,sessionNum:n,lastActionTime:i,engagementMs:i-e},null!==o&&void 0!==o?o:{})}incrementSessionNum(){const t=this._store.getOrCreate(s.SESSION_NUM_KEY,()=>0);this._store.saveOrUpdateValue(s.SESSION_NUM_KEY,t+1)}}e.default=s,s.SESSION_ID_KEY="trex-sessionId",s.SESSION_NUM_KEY="trex-sessionNum",s.LAST_ACTION_KEY="trex-lastActionTime",s.SESSION_START="sessionStart",s.SESSION_CLOSE="sessionClose"},"78c9":function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n("3906"));class s{constructor(t){this._cfg=t,this.exptFetcher=new r.default({timeoutMs:5e3,retries:2})}fetchExptToken(){return i(this,void 0,void 0,(function*(){return yield this.exptFetcher.fetch(this._cfg.exptTokenUrl).then(t=>t.text())}))}}e.default=s},"79de":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AllowedNamespace=void 0,function(t){t["TEST"]="test",t["SHOP"]="codashop",t["PAY"]="codapay",t["COMMUNICATION_SERVICE"]="communication-service",t["DISTRIBUTION"]="distribution",t["PUBLISHER_PORTAL"]="publisher-portal",t["RMS"]="risk-management-service",t["UNKNOWN"]="unknown"}(e.AllowedNamespace||(e.AllowedNamespace={}))},"809e":function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.CookieStore=void 0;const o=n("9677"),r=i(n("651e")),s=n("b432"),a=n("d9ab");class u extends o.ChainableStore{constructor(t,e){super(t),this._cfg=e}getOrCreate(t,e){if(this.isCookieAvailable()){const n=(0,r.default)();return n.get(t)?n.get(t):this._nextStore?this._nextStore.getOrCreate(t,e):e()}return e()}saveOrUpdateValue(t,e){var n,i,o,a;if(this.isCookieAvailable()){const c=(0,r.default)(),l={path:"/",priority:"high"};try{if(null!==(i=null===(n=this._cfg)||void 0===n?void 0:n.allowSubdomain)&&void 0!==i&&i&&null!==(a=null===(o=null===document||void 0===document?void 0:document.location)||void 0===o?void 0:o.origin)&&void 0!==a&&a){const t=(0,s.tld)(document.location.origin);(null===t||void 0===t?void 0:t.trim())&&(l.domain=this._domain="."+t.trim())}}catch(u){console.error(u)}c.set(t,e,l)}return e}getDomain(){return this._domain}isCookieAvailable(){return(0,a.safeIsClient)()}}e.CookieStore=u},"8b20":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CustomAttributes=void 0;const i=n("3b9a"),o=()=>({});let r=0;function s(t){const e=Date.now();e-r>5e3&&(console.warn(t),r=e)}class a{constructor(){this._baseAttributes=void 0}setBaseAttributesCallback(t){this._baseAttributes=t}get(){var t;return this.useCallback(null!==(t=this._baseAttributes)&&void 0!==t?t:o)}useCallback(t){var e;return(0,i.cleanedAttributes)(Object.fromEntries(Object.entries(null!==(e=t())&&void 0!==e?e:{}).filter(([t,e])=>{const n=(0,i.isValidAttribute)(e);return n||s(`ignoring invalid attribute ${t}:${e}`),n})))}}e.CustomAttributes=a},"8ec4":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.camelizeObjKeys=void 0;const i=n("edfcc");function o(t){return(0,i.camelizeKeys)(t)}e.camelizeObjKeys=o},9677:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChainableStore=void 0;class i{constructor(t){t&&(this._nextStore=t)}syncValue(t,e){this.saveOrUpdateValue(t,e),this._nextStore&&this._nextStore.syncValue(t,e)}}e.ChainableStore=i},"9e43":function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n("f421"),s=o(n("2fa2")),a=n("c5a8");class u{constructor(t){this.api=t,this.attributes={},this._store=new s.default({allowSubdomain:!0}),this.env=(0,a.getItem)("trex-env")}getExptTokenIdKey(){return u.ATTR_SSID_ID}getOrCreate(t){return i(this,void 0,void 0,(function*(){let e=(null===t||void 0===t?void 0:t.forceFetch)?void 0:this._store.getOrCreate(u.KEY,()=>{});return e||(this.fetchToken||(this.fetchToken=this.api.fetchExptToken()),e=yield this.fetchToken,(0,a.getItem)("trex-env")===this.env&&this._store.set(u.KEY,e),e)}))}getValue(){return this._store.getCachedValue(u.KEY)}getExptTokenId(t){if(t)try{const e=(0,r.decodeJwt)(t);return e.id}catch(e){let n="Unknown Error";e instanceof Error&&(n=e.message),console.error(`[decodeJwt] Error when decoding token: ${n}, jwt: ${t}`)}}}e.default=u,u.KEY="exptToken",u.ATTR_SSID_ID="exptTokenId"},a457c:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n("6a28")),s=o(n("3906")),a=o(n("3efd")),u=n("8b20"),c=n("79de"),l=n("c5a8");class d{setNamespace(t){t&&(Object.values(c.AllowedNamespace).includes(t)?this.namespace=t:console.error("invalid namespace provided: "+t))}setSession(t){this.session=t}getNamespace(){return this.namespace}constructor(t){var e;this.codaCookieId=t,this.namespace=c.AllowedNamespace.UNKNOWN,this.tracingMetadata={},this.ipFetcher=new s.default({timeoutMs:2e3,retries:3}),this.customAttributes=new u.CustomAttributes,null===(e=(0,a.default)())||void 0===e||e.setOnPushStateCallback("repopulateMetadataUponNewVisit:EX-161",()=>this.getOrPopulate().catch(t=>console.error(t)))}getUrl(){var t,e;return null===(e=null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.document)||void 0===t?void 0:t.location)||void 0===e?void 0:e.href}getCustomAttributes(){return this.customAttributes}getOrPopulate(){return i(this,void 0,void 0,(function*(){const t=this.customAttributes.get();if(0===Object.keys(t).length?delete this.tracingMetadata.customMetadata:this.tracingMetadata.customMetadata=t,this.tracingMetadata.ns=this.namespace,this.tracingMetadata.codaCookieId=yield this.codaCookieId.getOrCreate(),this.latestUrl===this.getUrl())return Object.assign({},this.tracingMetadata);this.tracingMetadata.fullUrl=this.getUrl(),this.tracingMetadata.ip||this.ipFetcher.fetch("https://api.ipify.org?format=text").then(t=>t.text()).then(t=>{this.tracingMetadata.ip=t}).catch(t=>console.error(t));const e=this.populateCampaignParams();if(this.tracingMetadata.libraryVersion||(this.tracingMetadata.libraryVersion=r.default),this.populateBrowserAttributes(),this.latestUrl=this.getUrl(),this.session){const t=yield this.session.get(e,this.tracingMetadata);this.tracingMetadata.sessionId=t.sessionId,this.tracingMetadata.sessionNum=t.sessionNum,this.tracingMetadata.engagementMs=t.engagementMs}return Object.assign({},this.tracingMetadata)}))}populateBrowserAttributes(){var t,e,n,i,o,r,s,a,u,c,l,d,h,v,f;const p=null===(e=null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.document)||void 0===t?void 0:t.location)||void 0===e?void 0:e.hostname;this.tracingMetadata.domainName!==p&&(this.tracingMetadata.domainName=p),this.tracingMetadata.userAgent||(this.tracingMetadata.userAgent=(null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===n?void 0:n.userAgent)||(null===(i=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===i?void 0:i.vendor)||(null===globalThis||void 0===globalThis?void 0:globalThis.opera)),this.tracingMetadata.os||(this.tracingMetadata.os=null!==(s=null===(r=null===(o=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===o?void 0:o.userAgentData)||void 0===r?void 0:r.platform)&&void 0!==s?s:null===globalThis||void 0===globalThis?void 0:globalThis.navigator.platform),this.tracingMetadata.mobile||(this.tracingMetadata.mobile=null!==(c=null===(u=null===(a=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===a?void 0:a.userAgentData)||void 0===u?void 0:u.mobile)&&void 0!==c?c:this.isMobileDevice(null!==(l=this.tracingMetadata.userAgent)&&void 0!==l?l:"")),this.tracingMetadata.browser||(this.tracingMetadata.browser=null!==(f=null===(v=null===(h=null===(d=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===d?void 0:d.userAgentData)||void 0===h?void 0:h.brands)||void 0===v?void 0:v.reduce((t,e)=>`${t}${""===t?"":"/"}${e.brand}:${e.version}`,""))&&void 0!==f?f:null===globalThis||void 0===globalThis?void 0:globalThis.navigator.appVersion)}populateCampaignParams(){const t=this.getQueryParams(),e=this.createCampaignList(t),n=this.getOldCampaignValue(e),i=this.shouldOverride(e);let o=!1;i&&(o=this.isCampaignNew(e),this.updateTracingMetadata(t));let r={};return o&&(r=this.updateCampaignStorage(e)),{campaignOverride:i,newCampaign:o,newCampaignObj:r,oldCampaignObj:n}}shouldOverride(t){return Object.values(t).some(t=>Boolean(t))}updateCampaignStorage(t){return Object.entries(t).reduce((t,[e,n])=>(this.isCampaignValueValid(n)?(0,l.setItem)(e,n):(0,l.removeItem)(e),t[e]=(0,l.getItem)(e),t),{})}getOldCampaignValue(t){return Object.keys(t).reduce((t,e)=>(t[e]=(0,l.getItem)(e),t),{})}updateTracingMetadata(t){const e=t=>void 0!==t?encodeURIComponent(t):t;Object.assign(this.tracingMetadata,{cid:e(t.cid),campaignId:e(t.utm_campaign),utmCampaign:e(t.utm_campaign),utmSource:e(t.utm_source),utmMedium:e(t.utm_medium),utmContent:e(t.utm_content),utmTerm:t.utm_term})}createCampaignList(t){return{campaignId:t.utm_campaign,utmCampaign:t.utm_campaign,utmSource:t.utm_source,utmMedium:t.utm_medium,utmContent:t.utm_content,utmTerm:t.utm_term,cid:t.cid}}getQueryParams(){var t,e;const n=new URLSearchParams(null===(e=null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.document)||void 0===t?void 0:t.location)||void 0===e?void 0:e.search);return Object.fromEntries(Array.from(n,([t,e])=>[t.toLowerCase(),e]))}isCampaignNew(t){return Object.entries(t).map(([t,e])=>{const n=""===e?void 0:e;return n!==(0,l.getItem)(t)}).some(Boolean)}isCampaignValueValid(t){return!!t||""===t}isMobileDevice(t){const e=[/(Android)(.+)(Mobile)/i,/BlackBerry/i,/iPhone|iPod/i,/Opera Mini/i,/IEMobile/i];return e.some(e=>t.match(e))}}e.default=d},a534:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ExperimentationBase=void 0;const r=n("c5a8"),s=n("809e"),a=n("237c"),u=n("b310"),c=n("ea01"),l=o(n("78c9")),d=o(n("9e43"));class h{constructor(){this.featuresLastUpdatedInMs=-1,this._observers=[]}setAttributeCallback(t){var e;return null===(e=this._metadata)||void 0===e||e.getCustomAttributes().setBaseAttributesCallback(t),this}getOrCreateDeviceId(){return i(this,void 0,void 0,(function*(){if("undefined"!==typeof this._cachedDeviceId)return this._cachedDeviceId;const t=new s.CookieStore(new a.LocalStorageStore),e=t.getOrCreate(h.DEVICEID_KEY,()=>(0,u.v4)());return this._cachedDeviceId=e,t.syncValue(h.DEVICEID_KEY,e),e}))}getOrCreateDeviceIdSSR(t,e){return i(this,void 0,void 0,(function*(){if("undefined"!==typeof this._cachedDeviceId)return this._cachedDeviceId;const n=new c.SSRCookieStore(t,e),i=n.getOrCreate(h.DEVICEID_KEY,()=>(0,u.v4)());return this._cachedDeviceId=i,n.syncValue(h.DEVICEID_KEY,i),i}))}attachObserver(t){return"function"===typeof t.featuresUpdated&&this._observers.push(t),this}detachObserver(t){const e=this._observers.indexOf(t);return e>-1&&this._observers.splice(e,1),this}refresh(){return i(this,void 0,void 0,(function*(){return yield this.fetch(this._cfg)}))}_featuresFetched(){this.featuresLastUpdatedInMs=(new Date).getTime(),this._notifyObservers()}_notifyObservers(){this._observers.forEach(t=>{t.featuresUpdated(this)})}_configurationUpdated(t){var e,n;let i=(null===(e=null===this||void 0===this?void 0:this._cfg)||void 0===e?void 0:e.mode)!==(null===t||void 0===t?void 0:t.mode);void 0===(null===(n=null===this||void 0===this?void 0:this._cfg)||void 0===n?void 0:n.mode)&&(i=!1),this._cfg=t;let o=(0,r.getItem)("trex-env");o||(o="prod",(0,r.setItem)("trex-env","prod")),i&&this._cfg.mode!==o?(0,r.setItem)("trex-env",this._cfg.mode):i&&this._cfg.mode===o&&(i=!1),this.exptToken=new d.default(new l.default(this._cfg)),this.exptToken.getOrCreate({forceFetch:i}).catch(t=>{console.log("[ExperimentationBase] Error when populating ExptToken attributes",t)})}getExptToken(){return this.exptToken?this.exptToken.getOrCreate():Promise.resolve(void 0)}getExptTokenId(){var t,e;const n=null===(t=this.exptToken)||void 0===t?void 0:t.getValue();return null===(e=this.exptToken)||void 0===e?void 0:e.getExptTokenId(n)}getCfg(){return this._cfg}}e.ExperimentationBase=h,h.DEVICEID_KEY="deviceId"},b432:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.tld=void 0;const o=i(n("651e")),r="__ctld__";function s(t){const e=t.hostname,n=e.split("."),i=n[n.length-1],o=[];if(4===n.length&&parseInt(i,10)>0)return o;if(n.length<=1)return o;for(let r=n.length-2;r>=0;--r)o.push(n.slice(r).join("."));return o}function a(t){try{return new URL(t)}catch(e){return}}function u(t){const e=a(t);if(!e)return;let n;const i=s(e),u=(0,o.default)();for(let o=0;o<i.length;++o){const t=i[o],e={domain:"."+t};try{if(u.set(r,"1",e),u.get(r)){u.remove(r,e),n=t;break}}catch(c){console.error(c);break}}return n}e.tld=u},b763:function(t,e,n){"use strict";function i(t){let e=!1;try{e=window[t];const n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&e&&0!==e.length}}Object.defineProperty(e,"__esModule",{value:!0});var o=!1,r=!1;function s(){return o||"undefined"===typeof analytics||(analytics.ready((function(){r=!0})),o=!0),r}function a(t){let e=void 0;try{e=s()&&analytics.user?analytics.user().anonymousId():t()}catch(n){console.error(n);try{e=t()}catch(n){e=n&&n.message?n.message:"getOrCreateSegmentAnonymousId error"}}return e}t.exports={storageAvailable:i,getOrCreateSegmentAnonymousId:a}},d1b8:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExperimentationConfigBuilder=e.ExperimentationConfig=void 0;class i{constructor(t,e,n,o,r,s,a){this.version=0,this._mode=i.MODE_PROD,this._fetchTimeoutMs=i.DEFAULT_FETCH_TIMEOUT_MS,this._fetchMaxRetries=i.DEFAULT_FETCH_MAX_RETRIES,this._endPointUrl=t,this._mode=e,this._errorHandler=n,this._fetchTimeoutMs=o,this._fetchMaxRetries=r,this._eventTrackingUrl=s,this._exptTokenUrl=a,this.version=++i.GLOBAL_CONFIG_VERSION}static builder(){return new o}_isEmptyString(t){return!t||0===t.trim().length}_hasMode(){return!!this._mode&&this._mode.trim().length>0&&this._mode in i.MODES_MAP}get endPointUrl(){return this._isEmptyString(this._endPointUrl)&&this._hasMode()?i.MODES_MAP[this._mode].endpoint.features:this._endPointUrl}get eventTrackingUrl(){return this._isEmptyString(this._eventTrackingUrl)&&this._hasMode()?i.MODES_MAP[this._mode].endpoint.eventTracking:this._eventTrackingUrl}get exptTokenUrl(){return this._isEmptyString(this._exptTokenUrl)&&this._hasMode()?i.MODES_MAP[this._mode].endpoint.exptToken:this._exptTokenUrl}get mode(){return this._mode}get errorHandler(){return this._errorHandler}get fetchTimeoutMs(){return this._fetchTimeoutMs}get fetchMaxRetries(){return this._fetchMaxRetries}get isProductionMode(){return this._mode===i.MODE_PROD}}e.ExperimentationConfig=i,i.DEFAULT_FETCH_TIMEOUT_MS=8e3,i.DEFAULT_FETCH_MAX_RETRIES=3,i.MODE_PROD="prod",i.MODE_STAGING="qa",i.MODE_DEV="dev",i.GLOBAL_CONFIG_VERSION=0,i.MODES_MAP={[i.MODE_PROD]:{endpoint:{features:"https://features-cdn.codainfra.com/features.json",eventTracking:"https://events.codainfra.com/topics/experiment-viewed",exptToken:"https://api-experiments.codainfra.com/api/v1/id"}},[i.MODE_STAGING]:{endpoint:{features:"https://features-cdn.codainfra.com/qa-features.json",eventTracking:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/experiment-viewed",exptToken:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/api/v1/id"}},[i.MODE_DEV]:{endpoint:{features:"https://features-cdn.codainfra.com/dev-features.json",eventTracking:"https://dev-events.codainfra.com/topics/experiment-viewed",exptToken:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/api/v1/id"}}};class o{constructor(){this.mode=i.MODE_PROD,this.fetchTimeoutMs=i.DEFAULT_FETCH_TIMEOUT_MS,this.fetchMaxRetries=i.DEFAULT_FETCH_MAX_RETRIES}setEndPointUrl(t){return this.endPointUrl=t,this}setEventTrackingUrl(t){return this.eventTrackingUrl=t,this}setExptTokenUrl(t){return this.exptTokenUrl=t,this}setMode(t){return this.mode=t,this}setErrorHandler(t){return this.errorHandler=t,this}setFetchTimeoutMs(t){return this.fetchTimeoutMs=t,this}setFetchMaxRetries(t){return this.fetchMaxRetries=t,this}build(){return new i(this.endPointUrl,this.mode,this.errorHandler,this.fetchTimeoutMs,this.fetchMaxRetries,this.eventTrackingUrl,this.exptTokenUrl)}}e.ExperimentationConfigBuilder=o},d9ab:function(t,e,n){"use strict";function i(t=!1){try{return"undefined"!==typeof window&&"undefined"!==typeof document&&"string"===typeof document.cookie}catch(e){return console.error(e),t}}Object.defineProperty(e,"__esModule",{value:!0}),e.safeIsClient=void 0,e.safeIsClient=i},dbcf:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))};function o(t){return i(this,void 0,void 0,(function*(){try{const e=yield t();return{ok:!0,value:e}}catch(e){return console.log(e),{ok:!1,error:e}}}))}Object.defineProperty(e,"__esModule",{value:!0}),e.safeGuard=void 0,e.safeGuard=o},ea01:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.SSRCookieStore=void 0;const o=n("9677"),r=i(n("651e"));class s extends o.ChainableStore{constructor(t,e,n){super(n),this._req=t,this._resp=e}getOrCreate(t,e){const n=(0,r.default)(this._req,this._resp);return n.get(t)?n.get(t):this._nextStore?this._nextStore.getOrCreate(t,e):e()}saveOrUpdateValue(t,e){const n=(0,r.default)(this._req,this._resp);return n.set(t,e),e}}e.SSRCookieStore=s},fe0e:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o={Accept:"*/*","Content-Type":"application/vnd.kafka.json.v2+json"};function r(t,e,...n){return i(this,void 0,void 0,(function*(){const i={records:(null!==n&&void 0!==n?n:[]).filter(t=>null!=t).map(t=>({value:t}))},r=yield e.fetch(t,{method:"POST",headers:o,body:JSON.stringify(i)});r.ok||console.error("HTTP response error! Status: "+r.status);const s={payload:n,finalPayload:i,response:r};return s}))}e.default=r},fe9c:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){function o(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{u(i.next(t))}catch(e){r(e)}}function a(t){try{u(i["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):o(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.traceConfigByEnvironment=void 0;const r=o(n("3efd")),s=n("dbcf");e.traceConfigByEnvironment={prod:{customEventEndpoint:"https://events.codainfra.com/topics/custom-events",pageViewEndpoint:"https://events.codainfra.com/topics/page-viewed",experimentViewedEndpoint:"https://events.codainfra.com/topics/experiment-viewed",clickEventEndpoint:"https://events.codainfra.com/topics/clicked",identifyEventEndpoint:"https://events.codainfra.com/topics/identified",sessionEndpoint:"https://events.codainfra.com/topics/trex-sessions"},qa:{customEventEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/custom-events",pageViewEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/page-viewed",experimentViewedEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/experiment-viewed",clickEventEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/clicked",identifyEventEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/identified",sessionEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/trex-sessions"},dev:{customEventEndpoint:"http://alb-expt-events-qa.codapay.net/topics/custom-events",pageViewEndpoint:"http://alb-expt-events-qa.codapay.net/topics/page-viewed",experimentViewedEndpoint:"http://alb-expt-events-qa.codapay.net/topics/experiment-viewed",clickEventEndpoint:"http://alb-expt-events-qa.codapay.net/topics/clicked",identifyEventEndpoint:"http://alb-expt-events-qa.codapay.net/topics/identified",sessionEndpoint:"https://api-experiments.codainfra-staging.com/dMcPNUpWQKVp/topics/trex-sessions"}};class a{constructor(t,e,n,i){this.cfg=t,this.pageViewInited=!1,this.codaCookieId=e,this.metadata=n,this.customEventTracer=i,this.toggleAutomaticPageViewEvent(!0)}toggleAutomaticPageViewEvent(t){return i(this,void 0,void 0,(function*(){return(0,s.safeGuard)(()=>{var e,n;t?null===(e=(0,r.default)())||void 0===e||e.setOnPushStateCallback(a.PUSH_STATE_PAGE_VIEW,()=>this.tracePageViewWithAdditionalInfo()):null===(n=(0,r.default)())||void 0===n||n.unsetOnPushStateCallback(a.PUSH_STATE_PAGE_VIEW)})}))}traceIdentifyEvent(t,e={}){return i(this,void 0,void 0,(function*(){return this.customEventTracer.traceIdentifyEvent(t,e)}))}traceIdentifyEvents(t){return i(this,void 0,void 0,(function*(){return this.customEventTracer.traceIdentifyEvent(t)}))}traceCustomEvent(t,e,n={}){return i(this,void 0,void 0,(function*(){return this.customEventTracer.traceCustomEvent(t,e,n)}))}traceCustomEvents(t){return i(this,void 0,void 0,(function*(){return this.customEventTracer.traceCustomEvents(t)}))}traceExperimentViewedEvent(t,e={}){return i(this,void 0,void 0,(function*(){return this.customEventTracer.traceExperimentViewedEvent(t,e)}))}traceExperimentViewedEvents(t){return i(this,void 0,void 0,(function*(){return this.customEventTracer.traceExperimentViewedEvents(t)}))}tracePageViewEvent(){return i(this,void 0,void 0,(function*(){return this.customEventTracer.tracePageViewEvent()}))}traceFirstPageView(){return i(this,void 0,void 0,(function*(){this.pageViewInited||(this.pageViewInited=!0,this.customEventTracer.tracePageViewEvent())}))}setPageViewAdditionalInfoCallback(t){null!=t&&(this.additionalInfoCallback=t)}tracePageViewWithAdditionalInfo(){return i(this,void 0,void 0,(function*(){return this.customEventTracer.tracePageViewEvent(this.additionalInfoCallback)}))}initCodaCookieId(){return i(this,void 0,void 0,(function*(){return this.codaCookieId.getOrCreate()}))}initMetadata(){return i(this,void 0,void 0,(function*(){return this.metadata.getOrPopulate()}))}initPageView(){return i(this,void 0,void 0,(function*(){return this.tracePageViewWithAdditionalInfo()}))}}e.default=a,a.PUSH_STATE_PAGE_VIEW="pageViewEventUponNewVisitAndSubsequentNavigation:EX-145-146"}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["codacashLandingPage~leftPanel~notifications~rewardsAndWallet~unverifiedPhoneModal~welcomeModal"],{8205:function(e,t,n){"use strict";var a=n("2b0e"),i=n("f2a8"),r=n.n(i),o=n("bb70"),s=n("567c");function c(e,t,n,a,i,r,o){try{var s=e[r](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(a,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var r=e.apply(t,n);function o(e){c(r,a,i,o,s,"next",e)}function s(e){c(r,a,i,o,s,"throw",e)}o(void 0)}))}}var u=a["a"].mixin({data:function(){return{walletWebSocket:null,walletWebsocketPing:null}},computed:{isWalletNotActivated:function(){return this.$store.getters["cash/isWalletNotActivated"]},isWalletActive:function(){return this.$store.getters["cash/isWalletActive"]},isWalletRestricted:function(){return this.$store.getters["cash/isWalletRestricted"]},isWalletReserved:function(){return this.$store.getters["cash/isWalletReserved"]},isWalletUnavailable:function(){return this.$store.getters["cash/isWalletUnavailable"]},isWalletCountrySuspended:function(){return this.$store.getters["cash/isCountryLocked"]},isWalletActivationsDisabled:function(){return this.$store.getters["cash/isActivationsDisabled"]},isMaxWalletAllowedReached:function(){return this.$store.getters["cash/isMaxAllowedReached"]},isUserWalletEligibleForPurchase:function(){return this.isWalletActive&&!this.isWalletCountrySuspended&&!this.isWalletUnavailable&&!this.showWalletExplainerSheet},isPhoneNumberSignUp:function(){return this.$store.getters["user/phoneVerified"]},isDokuCountry:function(){return"id"===this.$store.getters["locale/shopLang"].code},cashBalance:function(){var e=this.$store.getters["cash/wallet"].balanceAmount;return e||0},cashTotalSpent:function(){var e=this.$store.getters["cash/wallet"].totalSpent;return e||0},showWalletExplainerSheet:function(){return this.isWalletActive&&this.isPhoneNumberSignUp&&!this.isDokuCountry&&this.$store.getters["userSettings/showWalletExplainerSheet"]&&0===this.cashBalance&&0===this.cashTotalSpent},walletTaxRate:function(){var e=this.$store.getters["cash/countrySettings"].taxRate;return e}},methods:{getWalletAccessStatus:function(){var e=l(regeneratorRuntime.mark((function e(){var t,n,a,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],e.prev=1,!t){e.next=11;break}return e.next=5,this.$store.getters["locale/shopLang"];case 5:return n=e.sent,a=n.countryCode,e.next=9,this.$store.dispatch("cash/fetchWallet");case 9:return e.next=11,this.$store.dispatch("cash/fetchCountrySettings",a);case 11:if(!(this.isWalletRestricted||this.isWalletUnavailable||this.isWalletCountrySuspended||this.isWalletActivationsDisabled||this.isMaxWalletAllowedReached)){e.next=15;break}return e.abrupt("return",o["Fb"].RESTRICTED);case 15:if(!this.isWalletNotActivated){e.next=19;break}return e.abrupt("return",o["Fb"].UNVERIFIED);case 19:if(!this.isWalletActive){e.next=23;break}return e.abrupt("return",o["Fb"].ACTIVE);case 23:if(!this.isWalletReserved){e.next=27;break}return e.abrupt("return",o["Fb"].RESERVED);case 27:return e.abrupt("return",null);case 28:e.next=34;break;case 30:return e.prev=30,e.t0=e["catch"](1),console.log(e.t0),e.abrupt("return",null);case 34:case"end":return e.stop()}}),e,this,[[1,30]])})));function t(){return e.apply(this,arguments)}return t}(),verifyAndGoToWalletHome:function(){var e=l(regeneratorRuntime.mark((function e(){var t,n,a,i,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:"",n=!(r.length>1&&void 0!==r[1])||r[1],e.prev=2,a=this.$route.name,a!==s["a"].WalletVerification){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,this.getWalletAccessStatus(n);case 10:if(i=e.sent,i!==o["Fb"].ACTIVE||this.showWalletExplainerSheet){e.next=15;break}this.$router.push({name:s["a"].WalletHome}).catch((function(){})),e.next=30;break;case 15:if(!t){e.next=18;break}return e.next=18,this.$router.push({name:t}).catch((function(){}));case 18:if(i!==o["Fb"].RESTRICTED){e.next=23;break}return e.next=21,this.$store.dispatch("cash/showRestrictedModal",!0);case 21:e.next=30;break;case 23:if(![o["Fb"].UNVERIFIED,o["Fb"].RESERVED].includes(i)&&!this.showWalletExplainerSheet){e.next=29;break}if(t===s["a"].WalletVerification){e.next=27;break}return e.next=27,this.$store.dispatch("cash/showUnverifiedModal",!0);case 27:e.next=30;break;case 29:console.log("Attention: Unhandled wallet status");case 30:e.next=35;break;case 32:e.prev=32,e.t0=e["catch"](2),console.log("Error in wallet home navigation: ".concat(e.t0.message));case 35:case"end":return e.stop()}}),e,this,[[2,32]])})));function t(){return e.apply(this,arguments)}return t}(),trackConvertedNotification:function(e,t,n){try{var a=0;"CASH_TOPUP"===t?a=1:"ORDER"===t&&(a=2);var i={userId:e,conversionType:a,lvt:n};this.$apollo.mutate({mutation:r.a,variables:i})}catch(o){console.log(o)}},setupWalletWebsocket:function(e,t){try{this.walletWebSocket=new WebSocket("wss://wallet-ws.codacash.com"),this.walletWebSocket.onopen=function(t){var n=e.$store.getters["cash/wallet"].walletId,a={action:"topup",walletId:n};e.walletWebSocket.send(JSON.stringify(a))},this.walletWebsocketPing=setInterval(l(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.$store.getters["cash/wallet"].walletId,a={action:"ping",walletId:n},e.walletWebSocket.send(JSON.stringify(a));case 3:case"end":return t.stop()}}),t)}))),3e5),this.walletWebSocket.onmessage=function(){var n=l(regeneratorRuntime.mark((function n(a){var i,r,s,c,l,u,d,p,h,f,v,k;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=JSON.parse(a.data),isNaN(i.amount)){n.next=4;break}return n.next=4,e.$store.dispatch("cash/fetchWallet");case 4:if(e.walletTxnId!==i.walletTxnId){n.next=27;break}if("quick"!==t&&(e.loading=!1),r=parseInt(i.messageString),r===o["p"].SUCCESS){n.next=11;break}"quick"!==t?r===o["p"].WALLET_DAILY_TOPUP_MAX_LIMIT_REACHED||r===o["p"].WALLET_MONTHLY_TOPUP_MAX_LIMIT_REACHED||r===o["p"].COUNTRY_DAILY_TOPUP_MAX_LIMIT_REACHED||r===o["p"].COUNTRY_MONTHLY_TOPUP_MAX_LIMIT_REACHED?e.showTopupLimitReachedModal(parseInt(r)):(s=r===o["p"].PAY_INSUFFICIENT_BALANCE||r===o["p"].PAY_TXN_EXPIRED?e.$t("wallet.topup.error.".concat(r),{paymentChannel:e.paymentChannel.displayName}):e.$t("wallet.topup.error.".concat(r)),e.setTopupErrorModal(r,s,e.$t("wallet.topup.errorTitle.".concat(r)))):"quick"===t&&(e.showQuickTopupError||e.showQuickTopupTimer)&&(c=e.$t("wallet.topup.error.".concat(r)),r!==o["p"].PAY_INSUFFICIENT_BALANCE&&r!==o["p"].PAY_TXN_EXPIRED||(c=e.$t("wallet.topup.error.".concat(r),{paymentChannel:e.quickTopupDetails.pc.name})),e.quickTopupErrorDetails={title:e.$t("product.details.quickTopUpError.topUpCompletion.title"),content:c},e.showQuickTopupTimer&&!e.showQuickTopupError&&(e.showQuickTopupError=!0),e.showInfoModal=!1,e.showQuickTopupTimer=!1),n.next=26;break;case 11:if(l=e.$store.getters["guestNotification/guestUserId"],l&&e.trackConvertedNotification(l,"CASH_TOPUP"),"quick"!==t&&(e.showTopupSuccessModal=!0),u=e.$store.getters["cash/wallet"],d=u.walletId,p=u.userId,h=u.mobile,"quick"!==t?(f=e.paymentChannel.displayName,v=e.$options.filters.toCurrency(parseFloat(e.denom)),k=e.denom):(f=e.quickTopupDetails.pc.name,v=e.$options.filters.toCurrency(parseFloat(e.quickTopupDetails.denom.amount)),k=e.quickTopupDetails.denom.amount),e.triggerGtmDataLayerPush({event:"topUpCompleted",country:e.$store.getters["locale/shopLang"].code,topUpObj:{accountId:p,walletId:d,checkoutId:e.checkoutId,currency:e.$store.getters["locale/shopLang"].currency,orderId:e.codacashOrderId,paymentMethod:f,topupAmount:v,price:k,phoneNumber:h}}),"quick"!==t){n.next=26;break}if(e.clearQuickTopupPurchase(),e.showQuickTopupError||!(e.quickTopupTimer>0)){n.next=25;break}return e.showQuickTopupTimer=!1,n.next=23,e.callAirtime();case 23:n.next=26;break;case 25:e.quickTopupErrorDetails={title:e.$t("product.details.quickTopUpError.topUpSuccessOrderFailed.title"),content:e.$t("product.details.quickTopUpError.topUpSuccessOrderFailed.content",{productName:e.productName})};case 26:e.closeWalletWebsocket();case 27:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}catch(n){e.closeWalletWebsocket()}},closeWalletWebsocket:function(){this.walletWebSocket&&this.walletWebSocket.close(),this.walletWebsocketPing&&clearInterval(this.walletWebsocketPing)},round:function(e){return Math.round(100*(e+Number.EPSILON))/100},customCeil:function(e,t){return Math.ceil(e*Math.pow(10,t))/Math.pow(10,t)},computeWalletTax:function(e){return e=100*e/(this.walletTaxRate+100),e=this.round(e),e},parseCustomTopUpValue:function(e){try{if(!e)return 0;var t=e,n=this.$store.getters["locale/shopLang"].currencyRegexName;return n&&(t=this.invertCurrencyDecimalSeparator(t)),t=t.replaceAll(",",""),parseFloat(t)}catch(a){return 0}},invertCurrencyDecimalSeparator:function(e){return e&&(e=e.replace(/[,.]/g,(function(e){return","===e?".":","}))),e}}});t["a"]=u},f2a8:function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"TrackConvertedNotification"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversionType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"lvt"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"trackConvertedNotification"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"conversionType"},value:{kind:"Variable",name:{kind:"Name",value:"conversionType"}}},{kind:"Argument",name:{kind:"Name",value:"lvt"},value:{kind:"Variable",name:{kind:"Name",value:"lvt"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"statusCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"statusMessage"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:233}};n.loc.source={body:"mutation TrackConvertedNotification($userId: String!, $conversionType: Int!, $lvt: Int) {\n    trackConvertedNotification(userId: $userId, conversionType: $conversionType, lvt: $lvt) {\n        statusCode\n        statusMessage\n    }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var i={};function r(e,t){for(var n=0;n<e.definitions.length;n++){var a=e.definitions[n];if(a.name&&a.name.value==t)return a}}function o(e,t){var n={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=i[t]||new Set,o=new Set,s=new Set;a.forEach((function(e){s.add(e)}));while(s.size>0){var c=s;s=new Set,c.forEach((function(e){if(!o.has(e)){o.add(e);var t=i[e]||new Set;t.forEach((function(e){s.add(e)}))}}))}return o.forEach((function(t){var a=r(e,t);a&&n.definitions.push(a)})),n}(function(){n.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),i[e.name.value]=t}}))})(),e.exports=n,e.exports["TrackConvertedNotification"]=o(n,"TrackConvertedNotification")}}]);